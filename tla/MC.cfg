\* Copyright 2024 The etcd Authors
\*
\* Licensed under the Apache License, Version 2.0 (the "License");
\* you may not use this file except in compliance with the License.
\* You may obtain a copy of the License at
\*
\*     http://www.apache.org/licenses/LICENSE-2.0
\*
\* Unless required by applicable law or agreed to in writing, software
\* distributed under the License is distributed on an "AS IS" BASIS,
\* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
\* See the License for the specific language governing permissions and
\* limitations under the License.
\*
\* Model Checking configuration for MC.tla
\* Uses Symmetry and View optimizations for efficient state space exploration

CONSTANTS
    s1 = s1
    s2 = s2
    s3 = s3
    s4 = s4
    s5 = s5

    InitServer  = {s1, s2, s3}
    Server      = {s1, s2, s3}

    v1 = v1
    v2 = v2

    Values = {v1, v2}

    Nil = Nil

    ValueEntry = ValueEntry
    ConfigEntry = ConfigEntry

    Follower = Follower
    Candidate = Candidate
    Leader = Leader

    RequestVoteRequest = RequestVoteRequest
    RequestVoteResponse = RequestVoteResponse
    AppendEntriesRequest = AppendEntriesRequest
    AppendEntriesResponse = AppendEntriesResponse

    \* Progress state constants
    StateProbe = StateProbe
    StateReplicate = StateReplicate
    StateSnapshot = StateSnapshot

    \* Flow control configuration
    \* Set to a small value to trigger flow control logic quickly
    \* Production is usually 256, test with 2-4 is sufficient
    MaxInflightMsgs = 2
    MaxDrops = 2
    MaxDups = 0
    MaxCrashs = 1
    MaxTimeouts = 4
    MaxStepDown = 1
    MaxClientReqs = 4
    MaxHeartbeats = 4

INIT Init
NEXT NextAsyncCrash

VIEW View
SYMMETRY Symmetry

\* Original Raft properties
INVARIANTS
    LogInv
    MoreThanOneLeaderInv
    ElectionSafetyInv
    LogMatchingInv
    QuorumLogInv
    MoreUpToDateCorrectInv
    LeaderCompletenessInv

\* New Progress and Inflights invariants
\* INVARIANTS
\*     ProgressSafety

\* Optional: Check durable state consistency
INVARIANTS
    CommittedIsDurableInv
