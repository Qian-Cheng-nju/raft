SPECIFICATION mc_etcdSpec

CONSTANTS
    s1 = 1
    s2 = 2
    s3 = 3
    s4 = 4
    s5 = 5

    InitServer  = {s1, s2, s3}
    Server      = {s1, s2, s3}              \* 3节点（减少组合）

    ReconfigurationLimit    = 1             \* 保留配置变更！但限制次数
    MaxTermLimit            = 4             \* 减少任期（4足够测试选举）
    RequestLimit            = 3             \* 减少请求数

    \* 激进限制故障注入（核心状态空间减少点）
    RestartLimit            = 1
    DropLimit               = 1
    DuplicateLimit          = 1

    MaxInflightMsgs         = 2             \* 保持2（测试流控）

    Timeout         <- MCTimeout
    Send            <- MCSend
    ClientRequest   <- MCClientRequest
    AddNewServer    <- MCAddNewServer
    DeleteServer    <- MCDeleteServer
    AddLearner      <- MCAddLearner
    \* NEW: Override fault injection actions with limited versions
    Restart         <- MCRestart
    DropMessage     <- MCDropMessage
    DuplicateMessage <- MCDuplicateMessage
    
    InitServerVars  <- etcdInitServerVars
    InitLogVars     <- etcdInitLogVars
    InitConfigVars  <- etcdInitConfigVars

    Nil = 0

    ValueEntry  = "ValueEntry"
    ConfigEntry = "ConfigEntry"

    Follower    = "Follower"
    Candidate   = "Candidate"
    Leader      = "Leader"
    RequestVoteRequest      =   "RequestVoteRequest"
    RequestVoteResponse     =   "RequestVoteResponse"
    AppendEntriesRequest    =   "AppendEntriesRequest"
    AppendEntriesResponse   =   "AppendEntriesResponse"

    StateProbe      = "StateProbe"
    StateReplicate  = "StateReplicate"
    StateSnapshot   = "StateSnapshot"

SYMMETRY Symmetry
VIEW View

CHECK_DEADLOCK 
    FALSE

INVARIANTS
    LogInv
    MoreThanOneLeaderInv
    ElectionSafetyInv
    LogMatchingInv
    QuorumLogInv
    MoreUpToDateCorrectInv
    LeaderCompletenessInv
    CommittedIsDurableInv
    ProgressSafety
