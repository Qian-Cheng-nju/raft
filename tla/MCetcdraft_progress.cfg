SPECIFICATION mc_etcdSpec

CONSTANTS
    s1 = 1
    s2 = 2
    s3 = 3
    s4 = 4
    s5 = 5

    InitServer  = {s1, s2, s3}
    Server      = {s1, s2, s3, s4}

    ReconfigurationLimit    = 2
    MaxTermLimit            = 5
    RequestLimit            = 5

    \* NEW: Limits for fault injection to reduce state space
    RestartLimit            = 2
    DropLimit               = 2
    DuplicateLimit          = 2

    MaxInflightMsgs         = 2

    Timeout         <- MCTimeout
    Send            <- MCSend
    ClientRequest   <- MCClientRequest
    AddNewServer    <- MCAddNewServer
    DeleteServer    <- MCDeleteServer
    AddLearner      <- MCAddLearner
    \* NEW: Override fault injection actions with limited versions
    Restart         <- MCRestart
    DropMessage     <- MCDropMessage
    DuplicateMessage <- MCDuplicateMessage
    
    InitServerVars  <- etcdInitServerVars
    InitLogVars     <- etcdInitLogVars
    InitConfigVars  <- etcdInitConfigVars

    Nil = 0

    ValueEntry  = "ValueEntry"
    ConfigEntry = "ConfigEntry"

    Follower    = "Follower"
    Candidate   = "Candidate"
    Leader      = "Leader"
    RequestVoteRequest      =   "RequestVoteRequest"
    RequestVoteResponse     =   "RequestVoteResponse"
    AppendEntriesRequest    =   "AppendEntriesRequest"
    AppendEntriesResponse   =   "AppendEntriesResponse"

    StateProbe      = "StateProbe"
    StateReplicate  = "StateReplicate"
    StateSnapshot   = "StateSnapshot"

SYMMETRY Symmetry
VIEW View

CHECK_DEADLOCK 
    FALSE

INVARIANTS
    LogInv
    MoreThanOneLeaderInv
    ElectionSafetyInv
    LogMatchingInv
    QuorumLogInv
    MoreUpToDateCorrectInv
    LeaderCompletenessInv
    CommittedIsDurableInv
    ProgressSafety
